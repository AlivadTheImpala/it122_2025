<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"
      integrity="sha512-8bHTC73gkZ7rZ7vpqUQThUDhqcNFyYi2xgDgPDHc+GXVGHXq+xPjynxIopALmOPqzo9JZj0k6OqqewdGO3EsrQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      body {
        padding: 50px;
      }
    </style>
    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <title>Music</title>
  </head>

  <body class="container">
    <header>
      <div class="ui inverted menu">
        <a class="item" href="/"> Home </a>
      </div>
    </header>

    <div id="root"></div>

    <script type="text/babel">
      const AlbumForm = ({ item, changeHandler }) => {
        return (
          <form action="">
            <input
              className="ui segment"
              type="text"
              placeholder="Search Artist"
              name="artist"
              value={item.artist || ""}
              onChange={changeHandler}
            />

            <input
              className="ui segment"
              type="text"
              placeholder="Search Album"
              name="albumTitle"
              value={item.albumTitle || ""}
              onChange={changeHandler}
            />

            <button className="ui button" type="search">
              clear
            </button>
          </form>
        );
      };

      const DetailsContainer = ({ item, changeHandler }) => {
        console.log(item);

        return (
          <div className="ui segment">
            <h2>
              Details for {item.albumTitle} by {item.artist}
            </h2>
            <AlbumForm item={item} changeHandler={changeHandler} />
            <li>Release Date: {item.released}</li>
            <li>Genre: {item.genre}</li>
          </div>
        );
      };

      const AlbumList = ({ albums, clickHandler }) => {
        const albumItems = albums.map((album) => (
          // passes the album object to clickHandler(setSelectedItem)
          <li
            className="ui segment"
            key={album._id}
            onClick={() => clickHandler(album)}
          >
            {album.albumTitle} by {album.artist}
          </li>
        ));

        return <ul>{albumItems}</ul>;
      };

      const AlbumContainer = ({ albums, clickHandler }) => {
        // console.log(`This is from AlbumContainer`, albums);
        return (
          <div className="ui segment">
            <AlbumList albums={albums} clickHandler={clickHandler} />
          </div>
        );
      };

      //parent component
      const App = () => {
        const [items, setItems] = React.useState([]);
        const [selectedItem, setSelectedItem] = React.useState("");

        //fetch data from our albums database
        React.useEffect(() => {
          const fetchData = async () => {
            fetch("/api/albums/")
              .then((res) => res.json())
              .then((json) => {
                setItems(json);
              });
          };
          fetchData();
        }, []);

        const handleChange = (e) => {
          setSelectedItem((prev) => ({
            ...prev,
            [e.target.name]: e.target.value,
          }));
        };

        return (
          <div>
            <AlbumContainer albums={items} clickHandler={setSelectedItem} />
            <DetailsContainer
              item={selectedItem}
              changeHandler={handleChange}
            />
          </div>
        );
      };

      const container = document.getElementById("root");
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
    </script>
  </body>
</html>
